<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>xlsx2json by koalaylj</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">xlsx2json</h1>
        <p class="header">让excel可以表达复杂json格式，导出json，然后存入mongo数据库。</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/koalaylj/xlsx2json/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/koalaylj/xlsx2json/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/koalaylj/xlsx2json">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/koalaylj">koalaylj</a></p>


      </header>
      <section>
        <h1>
<a name="xlsx2json" class="anchor" href="#xlsx2json"><span class="octicon octicon-link"></span></a>xlsx2json</h1>

<h2>
<a name="%E4%BD%9C%E7%94%A8" class="anchor" href="#%E4%BD%9C%E7%94%A8"><span class="octicon octicon-link"></span></a>作用</h2>

<ul>
<li>让excel表达复杂的json格式</li>
<li>将excel转成json</li>
<li>将json导入mongo数据库。</li>
</ul>

<h2>
<a name="%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%81%9A%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE" class="anchor" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%81%9A%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE"><span class="octicon octicon-link"></span></a>为什么要做这个项目？</h2>

<p>开发游戏的时候，策划用的是excel，而我们的数据库是mongo。
我们的工作流是策划写excel，导出json，然后导入mongo数据库。</p>

<p>因为excel是二维的，无法表达mongo文档里面数组和subdocument等复杂结构。
按excel结构来设计mongo，会使mongo受限并无法使用某些特性。</p>

<p>有一个clojure项目 <a href="https://github.com/mhaemmerle/excel-to-json">excel-to-json </a> 可以完成这个功能。
但是不懂clojure表示压力很大而且有些功能不符合我们的需求。</p>

<p>so,就搞了这个项目。某些想法也是借鉴了<a href="https://github.com/mhaemmerle/excel-to-json">excel-to-json </a>，表示感谢。</p>

<h2>
<a name="%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" class="anchor" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="octicon octicon-link"></span></a>使用说明</h2>

<p>首次使用需要配置config.json</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"xlsx"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"head"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span><span class="err">//表头所在的行，第一行可以是注释，第二行是表头。</span>
        <span class="nt">"src"</span><span class="p">:</span> <span class="s2">"./excel/**/[^~$]*.xlsx"</span><span class="p">,</span> <span class="err">//xlsx文件</span> <span class="err">glob配置风格</span>
        <span class="nt">"dest"</span><span class="p">:</span> <span class="s2">"./json"</span>    <span class="err">//导出的json存放的位置</span>
    <span class="p">},</span>

    <span class="nt">"mongoimport"</span><span class="p">:</span> <span class="s2">".\\bin\\mongoimport.exe"</span><span class="p">,</span>

    <span class="nt">"db"</span><span class="p">:</span> <span class="p">{</span> <span class="err">//json要导入的数据库的配置，如果没有用户名密码，导入时候命令行加</span> <span class="err">--noauth</span>
        <span class="nt">"host"</span><span class="p">:</span> <span class="s2">"127.0.0.1"</span><span class="p">,</span>
        <span class="nt">"database"</span><span class="p">:</span> <span class="s2">"princess"</span><span class="p">,</span>
        <span class="nt">"user"</span><span class="p">:</span> <span class="s2">"princess"</span><span class="p">,</span>
        <span class="nt">"port"</span><span class="p">:</span> <span class="mi">27010</span><span class="p">,</span>
        <span class="nt">"pwd"</span><span class="p">:</span> <span class="s2">"pwd"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>注：node &amp; mongoimport 命令用的是.\bin下面的exe。node版本是0.10.26。mongoimport版本是2.6。</p>

<ul>
<li>查看帮助：执行<code>node index.js -h</code> 查看使用帮助；</li>
<li>excel导出json：双击<code>export.bat</code> 即可将 <code>./excel/*.xlsx</code> 文件导出到 <code>./json</code> 下。</li>
<li>json导入mongo：双击<code>import.bat</code>即可将./json下所有的json文件导入到数据库中。
collection的名字就是json文件的名字。
或者自己手动导入：
<code>mongoimport -h 127.0.0.1 --port 27017 -u username -p password -d db_name -c collection_name xxx.json --jsonArray</code>
</li>
<li>还支持命令行传参导入导出特定excel，具体使用 node <code>index.js --help</code> 查看。</li>
</ul>

<h4>
<a name="%E7%A4%BA%E4%BE%8B1-testxlsx" class="anchor" href="#%E7%A4%BA%E4%BE%8B1-testxlsx"><span class="octicon octicon-link"></span></a>示例1 test.xlsx</h4>

<p><img src="http://img3.douban.com/view/photo/photo/public/p2180848214.jpg" alt="test.xlsx"></p>

<p>输出如下：</p>

<div class="highlight highlight-json"><pre><span class="p">[{</span>
    <span class="nt">"id"</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
    <span class="nt">"desc"</span><span class="p">:</span> <span class="s2">"description"</span><span class="p">,</span>
    <span class="nt">"flag"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">"otherid"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="nt">"words"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"哈哈"</span><span class="p">,</span> <span class="s2">"呵呵"</span><span class="p">],</span>
    <span class="nt">"map"</span><span class="p">:</span> <span class="p">[</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span>
    <span class="nt">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"a"</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
        <span class="nt">"b"</span><span class="p">:</span> <span class="mi">45</span>
    <span class="p">},</span>
    <span class="nt">"hero"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="nt">"id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span><span class="nt">"level"</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span> 
      <span class="p">{</span><span class="nt">"id"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span><span class="nt">"level"</span><span class="p">:</span> <span class="mi">80</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="nt">"id"</span><span class="p">:</span> <span class="mi">456</span><span class="p">,</span>
    <span class="nt">"desc"</span><span class="p">:</span> <span class="s2">"描述"</span><span class="p">,</span>
    <span class="nt">"flag"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">"otherid"</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
    <span class="nt">"words"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"shit"</span><span class="p">,</span> <span class="s2">"my god"</span><span class="p">],</span>
    <span class="nt">"map"</span><span class="p">:</span> <span class="p">[</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span>
    <span class="nt">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"a"</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
        <span class="nt">"b"</span><span class="p">:</span> <span class="mi">22</span>
    <span class="p">},</span>
    <span class="nt">"hero"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="nt">"id"</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="nt">"level"</span><span class="p">:</span> <span class="mi">38</span> <span class="p">},</span> 
      <span class="p">{</span><span class="nt">"id"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span><span class="nt">"level"</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}]</span>
</pre></div>

<h2>
<a name="%E6%94%AF%E6%8C%81%E4%BB%A5%E4%B8%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" class="anchor" href="#%E6%94%AF%E6%8C%81%E4%BB%A5%E4%B8%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="octicon octicon-link"></span></a>支持以下数据类型</h2>

<ul>
<li>number 数字类型</li>
<li>boolean  布尔</li>
<li>string 字符串</li>
<li>object 对象  // 不支持对象内有数组以及对象嵌套对象，防止表格过度复杂。</li>
<li>number-array  数字数组</li>
<li>boolean-array  布尔数组</li>
<li>string-array  字符串数组</li>
<li>object-array 对象数组</li>
</ul>

<h2>
<a name="%E8%A1%A8%E5%A4%B4%E8%A7%84%E5%88%99" class="anchor" href="#%E8%A1%A8%E5%A4%B4%E8%A7%84%E5%88%99"><span class="octicon octicon-link"></span></a>表头规则</h2>

<ul>
<li>字段是基本数据类型(string,number,boolean)时候，不需要特殊设置。</li>
<li>字段是基本类型数组：此列表头的命名形式 <code>列名#[]</code> 。</li>
<li>字段是对象：此列表头的命名形式 <code>列名#{}</code> 。</li>
<li>字段是对象数组：此列表头的命名形式<code>列名#[{}]</code> 。</li>
</ul>

<h2>
<a name="%E6%95%B0%E6%8D%AE%E8%A7%84%E5%88%99" class="anchor" href="#%E6%95%B0%E6%8D%AE%E8%A7%84%E5%88%99"><span class="octicon octicon-link"></span></a>数据规则</h2>

<ul>
<li>关键符号都是半角符号。</li>
<li>数组使用逗号<code>,</code>分割。</li>
<li>对象属性使用分号<code>;</code>分割。</li>
</ul>

<h2>
<a name="%E5%8E%9F%E7%90%86%E8%AF%B4%E6%98%8E" class="anchor" href="#%E5%8E%9F%E7%90%86%E8%AF%B4%E6%98%8E"><span class="octicon octicon-link"></span></a>原理说明</h2>

<ul>
<li>依赖 <code>node-xlsx</code> 这个npm项目解析xlsx文件。</li>
<li>其实xlsx就是个zip文件，解压出来都是xml。
有一个xml存的string，有相应个xml存的sheet。
通过解析xml解析出excel数据(json格式)，这个就是<code>node-xlsx</code> 做的工作。</li>
<li>本项目只需利用 <code>node-xlsx</code> 解析xlsx文件，然后拼装自定的json数据。</li>
</ul>

<h2>
<a name="%E8%A1%A5%E5%85%85" class="anchor" href="#%E8%A1%A5%E5%85%85"><span class="octicon octicon-link"></span></a>补充</h2>

<ul>
<li>实验环境：win7_x64 + nodejs_v0.10.25</li>
<li>项目地址 <a href="https://github.com/koalaylj/xlsx2json">xlsx2json master</a>
</li>
<li>如有问题可以到QQ群内讨论：223460081</li>
<li>项目中的某些工具函数测试用例请参见我的gist js:validate &amp; js:convert。</li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
